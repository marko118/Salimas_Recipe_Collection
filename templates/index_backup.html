{% extends "base.html" %}
{% block title %}Home - My Recipe App{% endblock %}

{% block content %}
  <main style="text-align:center; max-width:900px; margin:auto;">
    <h2>Welcome to Salima’s Recipe Collection</h2>
    <p>Find and plan your meals easily.</p>

    <!-- Search box -->
    <form action="{{ url_for('search') }}" method="get" style="margin:1.5rem 0;">
      <input type="text" name="q" placeholder="Search recipes..." 
             style="width:70%; padding:1rem; font-size:1.1rem; border-radius:8px; border:1px solid #bbb;">
    </form>

    <!-- Quick tag buttons -->
    <div style="margin:1rem 0;">
      {% for tag in ['chicken', 'pasta', 'vegetarian'] %}
        <form action="{{ url_for('search') }}" method="get" style="display:inline;">
          <input type="hidden" name="tag" value="{{ tag }}">
          <button type="submit" 
                  style="margin:0.3rem; padding:0.6rem 1.2rem; border:none; border-radius:6px; background:#ddd; cursor:pointer;">
            {{ tag.title() }}
          </button>
        </form>
      {% endfor %}
    </div>

    <!-- Tag cloud -->
    <div style="margin:1.5rem 0; line-height:2rem;">
      {% for tag in all_tags %}
        <a href="{{ url_for('search') }}?tag={{ tag }}" 
           style="margin:0.4rem; text-decoration:none; color:#2f4f4f;">{{ tag }}</a>
      {% endfor %}
    </div>

<!-- Recipe results with Select Dish buttons -->
<div style="text-align:left; margin-top:2rem;">
  <h3>Recipes tagged “{{ default_tag }}”</h3>

  {% for r in recipes %}
    <div style="border-bottom:1px solid #ddd; padding:0.6rem 0;">
      <a href="{{ url_for('recipe_detail', recipe_id=r[0]) }}"
         style="text-decoration:none; color:#2f4f4f;">
        <strong>{{ r[1] }}</strong>
      </a>
      — {{ r[2][:80] }}...

      <!-- ✅ Add Select Dish button -->
      <button class="select-dish-btn"
              data-id="{{ r[0] }}"
              data-name="{{ r[1] }}"
              style="margin-left:1em; padding:0.2em 0.6em; border:1px solid #999;
                     border-radius:6px; background:#f7f7ff; cursor:pointer;">
        ➕ Select Dish
      </button>
    </div>
  {% endfor %}
</div>

  <!-- Clear Selected Dishes button -->
  <div style="margin-top:2em; text-align:center;">
    <button id="clearSelectedBtn"
            style="padding:0.5em 1.2em; border:1px solid #888; border-radius:8px; background:#f7f7ff; cursor:pointer;">
      Clear Selected Dishes
    </button>
  </div>

  <script>
function updateMealCount() {
  const stored = JSON.parse(localStorage.getItem("selectedRecipes") || "[]");
  const counter = document.getElementById("mealCount");
  if (counter) counter.textContent = `# Meals selected: ${stored.length}`;
}

// ✅ Restore selected buttons when the page loads
document.addEventListener("DOMContentLoaded", () => {
  const stored = JSON.parse(localStorage.getItem("selectedRecipes") || "[]");
  stored.forEach(sel => {
    const btn = document.querySelector(`.select-dish-btn[data-id='${sel.id}']`);
    if (btn) btn.textContent = "✔ Selected";
  });
  updateMealCount();
});

// ✅ Handle clicking the Select Dish buttons
document.addEventListener("click", e => {
  if (!e.target.classList.contains("select-dish-btn")) return;
  const btn = e.target;
  const id = btn.dataset.id;
  const name = btn.dataset.name;
  let stored = JSON.parse(localStorage.getItem("selectedRecipes") || "[]");

  const exists = stored.find(r => r.id == id);
  if (exists) {
    stored = stored.filter(r => r.id != id);
    btn.textContent = "➕ Select Dish";
  } else {
    stored.push({ id, name });
    btn.textContent = "✔ Selected";
  }

  localStorage.setItem("selectedRecipes", JSON.stringify(stored));
  updateMealCount();
});

// ✅ Clear all selected dishes
document.getElementById("clearSelectedBtn").addEventListener("click", () => {
  if (confirm("Clear all selected dishes?")) {
    localStorage.removeItem("selectedRecipes");
    alert("✅ All selected dishes cleared.");
    updateMealCount();
    document.querySelectorAll(".select-dish-btn").forEach(btn => {
      btn.textContent = "➕ Select Dish";
    });
  }
});
</script>



</main>
{% endblock %}

