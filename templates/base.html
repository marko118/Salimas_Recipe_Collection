<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Salima's Recipes{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

  <!-- Title header (scrolls away) -->
<header class="site-header">
  <h1 class="site-title"><a href="/">üç≤ Salima's Recipes</a></h1>
</header>

<!-- Sticky nav (independent) -->
<nav class="site-nav">
  <a href="/">Home</a> |
  <a href="/add">Add</a> |
  <a href="{{ url_for('admin_tags') }}">Manage Tags</a> |
  <a href="{{ url_for('planner') }}">Planner</a>
</nav>


  <!-- === GLOBAL CONTROL SPACE (Sticky under nav) === -->
  <div id="control-space" class="control-space">
    {% if 'recipe' in request.path %}
      <a href="{{ url_for('edit_recipe', recipe_id=request.view_args.get('recipe_id', 0)) }}"
         id="editBtn"
         class="btn-edit"
         style="margin-right:1rem;">‚úèÔ∏è Edit</a>
    {% endif %}

    <button id="clearSelectedBtn" class="btn-clear">Clear Selections</button>
    <span id="mealCount" class="meal-count"># Meals selected: 0</span>
  </div>

  <!-- === MAIN PAGE CONTENT === -->
  <main>
    {% block content %}{% endblock %}
  </main>

  <!-- === FOOTER === -->
  <footer class="site-footer">
    &copy; {{ 2025|default(2025) }} Salima‚Äôs Recipes
  </footer>

  <!-- === GLOBAL JS === -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {

      // --- Meal counter ---
      const updateMealCount = () => {
        const stored = JSON.parse(localStorage.getItem("selectedRecipes") || "[]");
        document.querySelectorAll("#mealCount").forEach(el => {
          el.textContent = `# Meals selected: ${stored.length}`;
        });
      };
      window.updateMealCount = updateMealCount;
      updateMealCount();

      // --- Double-tap clear button ---
      const clearBtn = document.getElementById("clearSelectedBtn");
      if (clearBtn) {
        let waiting = false;
        clearBtn.addEventListener("click", () => {
          if (!waiting) {
            clearBtn.textContent = "Tap again to confirm";
            clearBtn.classList.add("btn-waiting");
            waiting = true;
            setTimeout(() => {
              clearBtn.textContent = "Clear Selections";
              clearBtn.classList.remove("btn-waiting");
              waiting = false;
            }, 2500);
            return;
          }
          // Confirmed clear
          localStorage.removeItem("selectedRecipes");
          document.querySelectorAll(".select-dish-btn").forEach(btn => {
            btn.classList.remove("selected");
          });
          updateMealCount();
          clearBtn.textContent = "Cleared!";
          clearBtn.classList.add("btn-cleared");
          setTimeout(() => {
            clearBtn.textContent = "Clear Selections";
            clearBtn.classList.remove("btn-cleared");
          }, 1500);
          waiting = false;
        });
      }

      // --- ‚ÄúSaved!‚Äù feedback when returning from edit ---
      const params = new URLSearchParams(window.location.search);
      if (params.has("saved")) {
        const editBtn = document.querySelector("#editBtn");
        if (editBtn) {
          const originalText = editBtn.textContent;
          editBtn.textContent = "‚úÖ Saved!";
          editBtn.style.background = "#00b35f";
          editBtn.style.color = "#fff";
          setTimeout(() => {
            editBtn.textContent = originalText;
            editBtn.style.background = "var(--brand)";
            editBtn.style.color = "white";
            const url = new URL(window.location);
            url.searchParams.delete("saved");
            window.history.replaceState({}, "", url);
          }, 1800);
        }
      }
    });
  </script>

</body>
</html>
